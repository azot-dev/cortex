---
sidebar_position: 3
---

# Basic example

The classic example of a counter

:::tip What You'll Learn

- How to create a simple service and bind it to your React app

:::

:::info Prerequisites

- Familiarity with [Typescript](https://www.typescriptlang.org/docs/handbook/typescript-in-5-minutes.html)
- Familiarity with [Typescript class syntax](https://www.typescriptlang.org/docs/handbook/classes.html)

:::

## The service

### Create the new service

First we create the file `counter.service.ts`

The created service must extend `Service` which has been auto-generated in the setup step

```ts
export class CounterService extends Service {

}
```

### Service state

Each service has a local state that is automatically proxified with valtio for reactivity

Pass the `State` type to the extended Service as `Service<State>`

```ts
// highlight-next-line
type State = { count: number };

export class CounterService extends Service<State> {
// highlight-next-line
  state: State = { count: 0 };
}
```

### Append a method

Each method has access to the local state which is automatically reactive thanks to valtio

You can directly modify the state properties - valtio will automatically track changes

```ts
type State = { count: number };

export class CounterService extends Service<State> {
  state: State = { count: 0 };

// highlight-start
  increment() {
    this.state.count++;
  }
 // highlight-end
}
```

### Register the service

In the file `_services`

```ts
// highlight-next-line
import { CounterService } from './counter.service';

export const services = {
// highlight-next-line
  counter: CounterService,
};
```

### Wrap the App with the CortexProvider

```tsx
 {/* highlight-next-line */}
 <CortexProvider core={createCore()}>
    <App />
{/* highlight-next-line */}
 </CortexProvider> 
```

### Use the methods in the app

Use the hook `useService` with the name of the service, here `counter`

You can access any method by destructuring this hook return value, and use it in the JSX

```tsx
const InnerApp: FC = () => {
{/* highlight-next-line */}
  const { increment } = useService('counter');

  return (
    <div>
    {/* highlight-next-line */}
        <button onClick={increment}>increment counter value</button> 
    </div>
  );
};
```

### Access the state in the app

You can access the state directly from the service using the typed `useService` hook. The state is automatically reactive thanks to valtio, so any state change will trigger a re-render.

```tsx
const InnerApp: FC = () => {
  {/* highlight-next-line */}
  const { increment, count } = useService('counter');

  return (
    <div>
        <button onClick={increment}>+</button>
{/* highlight-next-line */}
        <span>{count}</span> 
    </div>
  );
};
```

### Test the behavior

Since all the logic is completely decoupled from React, we can test the behavior of our app with Jest

```typescript
describe('counter', () => {
  it('should be incremented', () => {
    const core = createCore()

    expect(core.getService('counter').state.count).toBe(0)

    core.getService('counter').increment()
    expect(core.getService('counter').state.count).toBe(1)
  })
}) 
```
